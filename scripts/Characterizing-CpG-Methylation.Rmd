---
title: "Chacterizing CpG Methylation"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

In this script, I'll create summary tables and figures to characterize CpG methylation in *M. capitata* and *P. acuta* using WGBS, RRBS, and MBD-BSSeq. I will use a list of CpGs with at least 5x coverage in any samples.

# Session information

```{r}
sessionInfo()
```

# Summary tables

## CpG distribution

### Mcap

#### Import file counts

```{r}
McapAll <- read.table("../analyses/Characterizing-CpG-Methylation-5x/Mcap/Mcap-5x-bedgraph-counts.txt", header = FALSE, col.names = c("totalLines", "filename")) #Import file using space as a delimiter. Columns are the number of lines and the filename
McapAll <- McapAll[-10,] #Remove last row (total lines for all files)
tail(McapAll) #Confirm import
```

```{r}
McapMeth <- read.table("../analyses/Characterizing-CpG-Methylation-5x/Mcap/Mcap-5x-Meth-counts.txt", header = FALSE, col.names = c("Meth", "filename")) #Import file using space as a delimiter. Columns are the number of lines and the filename
McapMeth <- McapMeth[-10,] #Remove last row (total lines for all files)
tail(McapMeth) #Confirm import
```

```{r}
McapSparseMeth <- read.table("../analyses/Characterizing-CpG-Methylation-5x/Mcap/Mcap-5x-sparseMeth-counts.txt", header = FALSE, col.names = c("sparseMeth", "filename")) #Import file using space as a delimiter. Columns are the number of lines and the filename
McapSparseMeth <- McapSparseMeth[-10,] #Remove last row (total lines for all files)
tail(McapSparseMeth) #Confirm import
```

```{r}
McapUnMeth <- read.table("../analyses/Characterizing-CpG-Methylation-5x/Mcap/Mcap-5x-unMeth-counts.txt", header = FALSE, col.names = c("unMeth", "filename")) #Import file using space as a delimiter. Columns are the number of lines and the filename
McapUnMeth <- McapUnMeth[-10,] #Remove last row (total lines for all files)
tail(McapUnMeth) #Confirm import
```

#### Create summary table

```{r}
McapCpGType <- cbind(McapAll, McapMeth, McapSparseMeth, McapUnMeth) #Mash tables together by column
McapCpGType <- McapCpGType[,-c(2,4,6,8)] #Remove filename columns
tail(McapCpGType) #Confirm table mashing
```

```{r}
McapCpGType$percentMeth <- (McapCpGType$Meth / McapCpGType$totalLines) * 100 #Calculate percent methylated loci
McapCpGType$percentSparseMeth <- (McapCpGType$sparseMeth / McapCpGType$totalLines) * 100 #Calculate percent sparsely methylated loci
McapCpGType$percentUnMeth <- (McapCpGType$unMeth / McapCpGType$totalLines) * 100 #Calculate percent unmethylated loci
McapCpGType <- McapCpGType[,c(1, 2, 5, 3, 6, 4, 7)] #Reorganize columns
tail(McapCpGType) #Confirm calculations
```

```{r}
write.table(McapCpGType, "../analyses/Characterizing-CpG-Methylation-5x/Mcap/Mcap-CpG-Type.txt", sep = "\t", quote = FALSE, row.names = TRUE) #Save summary table
```

### Pact

#### Import file counts

```{r}
PactAll <- read.table("../analyses/Characterizing-CpG-Methylation-5x/Pact/Pact-5x-bedgraph-counts.txt", header = FALSE, col.names = c("totalLines", "filename")) #Import file using space as a delimiter. Columns are the number of lines and the filename
PactAll <- PactAll[-10,] #Remove last row (total lines for all files)
tail(PactAll) #Confirm import
```

```{r}
PactMeth <- read.table("../analyses/Characterizing-CpG-Methylation-5x/Pact/Pact-5x-Meth-counts.txt", header = FALSE, col.names = c("Meth", "filename")) #Import file using space as a delimiter. Columns are the number of lines and the filename
PactMeth <- PactMeth[-10,] #Remove last row (total lines for all files)
tail(PactMeth) #Confirm import
```

```{r}
PactSparseMeth <- read.table("../analyses/Characterizing-CpG-Methylation-5x/Pact/Pact-5x-sparseMeth-counts.txt", header = FALSE, col.names = c("sparseMeth", "filename")) #Import file using space as a delimiter. Columns are the number of lines and the filename
PactSparseMeth <- PactSparseMeth[-10,] #Remove last row (total lines for all files)
tail(PactSparseMeth) #Confirm import
```

```{r}
PactUnMeth <- read.table("../analyses/Characterizing-CpG-Methylation-5x/Pact/Pact-5x-unMeth-counts.txt", header = FALSE, col.names = c("unMeth", "filename")) #Import file using space as a delimiter. Columns are the number of lines and the filename
PactUnMeth <- PactUnMeth[-10,] #Remove last row (total lines for all files)
tail(PactUnMeth) #Confirm import
```

#### Create summary table

```{r}
PactCpGType <- cbind(PactAll, PactMeth, PactSparseMeth, PactUnMeth) #Mash tables together by column
PactCpGType <- PactCpGType[,-c(2,4,6,8)] #Remove filename columns
tail(PactCpGType) #Confirm table mashing
```

```{r}
PactCpGType$percentMeth <- (PactCpGType$Meth / PactCpGType$totalLines) * 100 #Calculate percent methylated loci
PactCpGType$percentSparseMeth <- (PactCpGType$sparseMeth / PactCpGType$totalLines) * 100 #Calculate percent sparsely methylated loci
PactCpGType$percentUnMeth <- (PactCpGType$unMeth / PactCpGType$totalLines) * 100 #Calculate percent unmethylated loci
PactCpGType <- PactCpGType[,c(1, 2, 5, 3, 6, 4, 7)] #Reorganize columns
tail(PactCpGType) #Confirm calculations
```

```{r}
write.table(PactCpGType, "../analyses/Characterizing-CpG-Methylation-5x/Pact/Pact-CpG-Type.txt", sep = "\t", quote = FALSE, row.names = TRUE) #Save summary table
```

## CpG overlaps

### Mcap

#### Genes

#### CDS

#### Introns

#### Intergenic regions

### Pact

#### Genes

#### CDS

#### Introns

#### Intergenic regions

# CpG distributions

## Import data

### Mcap

#### Sample 1

```{r}
cpgMethylationWGBS1 <- read.delim("../analyses/Characterizing-CpG-Methylation/Meth10.fastp-trim.202003063900_R1_001_bismark_bt2_pe._10x.bedgraph-Mcap", header = FALSE) #Import file with CpG methylation for all loci with 10x coverage
colnames(cpgMethylationWGBS1) <- c("chromosome", "start", "end", "methylation") #Add column names
head(cpgMethylationWGBS1) #Confirm import
```

```{r}
cpgMethylationRRBS1 <- read.delim("../analyses/Characterizing-CpG-Methylation/Meth13.fastp-trim.202003062040_R1_001_bismark_bt2_pe_10x.bedgraph-Mcap", header = FALSE) #Import file with CpG methylation for all loci with 10x coverage
colnames(cpgMethylationRRBS1) <- c("chromosome", "start", "end", "methylation") #Add column names
head(cpgMethylationRRBS1) #Confirm import
```

```{r}
cpgMethylationMBD1 <- read.delim("../analyses/Characterizing-CpG-Methylation/Meth16.fastp-trim.202003062412_R1_001_bismark_bt2_pe._10x.bedgraph-Mcap", header = FALSE) #Import file with CpG methylation for all loci with 10x coverage
colnames(cpgMethylationMBD1) <- c("chromosome", "start", "end", "methylation") #Add column names
head(cpgMethylationMBD1) #Confirm import
```

#### Sample 2

```{r}
cpgMethylationWGBS2 <- read.delim("../analyses/Characterizing-CpG-Methylation/Meth11.fastp-trim.202003065734_R1_001_bismark_bt2_pe._10x.bedgraph-Mcap", header = FALSE) #Import file with CpG methylation for all loci with 10x coverage
colnames(cpgMethylationWGBS2) <- c("chromosome", "start", "end", "methylation") #Add column names
head(cpgMethylationWGBS2) #Confirm import
```

```{r}
cpgMethylationRRBS2 <- read.delim("../analyses/Characterizing-CpG-Methylation/Meth14.fastp-trim.202003064415_R1_001_bismark_bt2_pe_10x.bedgraph-Mcap", header = FALSE) #Import file with CpG methylation for all loci with 10x coverage
colnames(cpgMethylationRRBS2) <- c("chromosome", "start", "end", "methylation") #Add column names
head(cpgMethylationRRBS2) #Confirm import
```

```{r}
cpgMethylationMBD2 <- read.delim("../analyses/Characterizing-CpG-Methylation/Meth17.fastp-trim.202003063731_R1_001_bismark_bt2_pe._10x.bedgraph-Mcap", header = FALSE) #Import file with CpG methylation for all loci with 10x coverage
colnames(cpgMethylationMBD2) <- c("chromosome", "start", "end", "methylation") #Add column names
head(cpgMethylationMBD2) #Confirm import
```

#### Sample 3

```{r}
cpgMethylationWGBS3 <- read.delim("../analyses/Characterizing-CpG-Methylation/Meth12.fastp-trim.202003060645_R1_001_bismark_bt2_pe._10x.bedgraph-Mcap", header = FALSE) #Import file with CpG methylation for all loci with 10x coverage
colnames(cpgMethylationWGBS3) <- c("chromosome", "start", "end", "methylation") #Add column names
head(cpgMethylationWGBS3) #Confirm import
```

```{r}
cpgMethylationRRBS3 <- read.delim("../analyses/Characterizing-CpG-Methylation/Meth15.fastp-trim.202003065503_R1_001_bismark_bt2_pe_10x.bedgraph-Mcap", header = FALSE) #Import file with CpG methylation for all loci with 10x coverage
colnames(cpgMethylationRRBS3) <- c("chromosome", "start", "end", "methylation") #Add column names
head(cpgMethylationRRBS3) #Confirm import
```

```{r}
cpgMethylationMBD3 <- read.delim("../analyses/Characterizing-CpG-Methylation/Meth18.fastp-trim.202003065117_R1_001_bismark_bt2_pe._10x.bedgraph-Mcap", header = FALSE) #Import file with CpG methylation for all loci with 10x coverage
colnames(cpgMethylationMBD3) <- c("chromosome", "start", "end", "methylation") #Add column names
head(cpgMethylationMBD3) #Confirm import
```

## Create individual figures to test options

```{r}
hist(cpgMethylationWGBS1$methylation)
hist(cpgMethylationRRBS1$methylation)
hist(cpgMethylationMBD1$methylation)

hist(cpgMethylationWGBS2$methylation)
hist(cpgMethylationRRBS2$methylation)
hist(cpgMethylationMBD2$methylation)

hist(cpgMethylationWGBS3$methylation)
hist(cpgMethylationRRBS3$methylation)
hist(cpgMethylationMBD3$methylation)
```

```{r}
plot(density(cpgMethylationWGBS1$methylation))
plot(density(cpgMethylationRRBS1$methylation))
plot(density(cpgMethylationMBD1$methylation))

plot(density(cpgMethylationWGBS2$methylation))
plot(density(cpgMethylationRRBS2$methylation))
plot(density(cpgMethylationMBD2$methylation))

plot(density(cpgMethylationWGBS3$methylation))
plot(density(cpgMethylationRRBS3$methylation))
plot(density(cpgMethylationMBD3$methylation))
```

## Create multipanel figure with all samples

```{r}
par(mfrow = c(3,3))
hist(cpgMethylationWGBS1$methylation, main = "")
hist(cpgMethylationRRBS1$methylation, main = "")
hist(cpgMethylationMBD1$methylation, main = "")

hist(cpgMethylationWGBS2$methylation, main = "")
hist(cpgMethylationRRBS2$methylation, main = "")
hist(cpgMethylationMBD2$methylation, main = "")

hist(cpgMethylationWGBS3$methylation, main = "")
hist(cpgMethylationRRBS3$methylation, main = "")
hist(cpgMethylationMBD3$methylation, main = "")
```

